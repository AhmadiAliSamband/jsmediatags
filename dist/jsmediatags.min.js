(function(v){"object"===typeof exports&&"undefined"!==typeof module?module.exports=v():"function"===typeof define&&define.amd?define([],v):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).jsmediatags=v()})(function(){return function f(m,k,l){function h(b,a){if(!k[b]){if(!m[b]){var e="function"==typeof require&&require;if(!a&&e)return e(b,!0);if(d)return d(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",e;}e=k[b]=
{exports:{}};m[b][0].call(e.exports,function(a){var e=m[b][1][a];return h(e?e:a)},e,e.exports,f,m,k,l)}return k[b].exports}for(var d="function"==typeof require&&require,b=0;b<l.length;b++)h(l[b]);return h}({1:[function(f,m,k){},{}],2:[function(f,m,k){m.exports=XMLHttpRequest},{}],3:[function(f,m,k){function l(b,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);b.prototype=Object.create(c&&c.prototype,{constructor:{value:b,
enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(b,c):b.__proto__=c)}var h=function(){function b(b,a){for(var e=0;e<a.length;e++){var g=a[e];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(b,g.key,g)}}return function(c,a,e){a&&b(c.prototype,a);e&&b(c,e);return c}}();f("./FlowTypes");var d=f("./ChunkedFileData");f=function(b){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");
var e;e=Object.getPrototypeOf(c).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;e._blob=a;e._fileData=new d;return e}l(c,b);h(c,[{key:"_init",value:function(a){this._size=this._blob.size;setTimeout(a.onSuccess,1)}},{key:"loadRange",value:function(a,e){var g=this,b=(this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice).call(this._blob,a[0],a[1]+1),c=new FileReader;c.onloadend=
function(b){b=new Uint8Array(c.result);g._fileData.addData(a[0],b);e.onSuccess()};c.onerror=c.onabort=function(a){if(e.onError)e.onError({type:"blob",info:c.error})};c.readAsArrayBuffer(b)}},{key:"getByteAt",value:function(a){return this._fileData.getByteAt(a)}}],[{key:"canReadFile",value:function(a){return"undefined"!==typeof Blob&&a instanceof Blob||"undefined"!==typeof File&&a instanceof File}}]);return c}(f("./MediaFileReader"));m.exports=f},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":10}],
4:[function(f,m,k){var l=function(){function f(d,b){for(var c=0;c<b.length;c++){var a=b[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(d,a.key,a)}}return function(d,b,c){b&&f(d.prototype,b);c&&f(d,c);return d}}();f("./FlowTypes");f=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._fileData=[]}l(f,null,[{key:"NOT_FOUND",get:function(){return-1}}]);l(f,[{key:"addData",value:function(d,
b){var c=d+b.length-1,a=this._getChunkRange(d,c);if(-1===a.startIx)this._fileData.splice(a.insertIx||0,0,{offset:d,data:b});else{var e=this._fileData[a.startIx],g=this._fileData[a.endIx],c=c<g.offset+g.data.length-1,p={offset:Math.min(d,e.offset),data:b};d>e.offset&&(e=e.data.slice(0,d-e.offset),p.data=this._concatData(e,b));c&&(e=p.data.slice(0,g.offset-p.offset),p.data=this._concatData(e,g.data));this._fileData.splice(a.startIx,a.endIx-a.startIx+1,p)}}},{key:"_concatData",value:function(d,b){if("undefined"!==
typeof ArrayBuffer&&ArrayBuffer.isView(d)){var c=new d.constructor(d.length+b.length);c.set(d,0);c.set(b,d.length);return c}return d.concat(b)}},{key:"_getChunkRange",value:function(d,b){for(var c=-1,a=-1,e=0,g=0;g<this._fileData.length;g++,e=g){var p=this._fileData[g].offset,q=p+this._fileData[g].data.length;if(b<p-1)break;if(d<=q+1&&b>=p-1){c=g;break}}if(-1===c)return{startIx:-1,endIx:-1,insertIx:e};for(g=c;g<this._fileData.length&&!(p=this._fileData[g].offset,q=p+this._fileData[g].data.length,
b>=p-1&&(a=g),b<=q+1);g++);-1===a&&(a=c);return{startIx:c,endIx:a}}},{key:"hasDataRange",value:function(d,b){for(var c=0;c<this._fileData.length;c++){var a=this._fileData[c];if(b<a.offset)break;if(d>=a.offset&&b<a.offset+a.data.length)return!0}return!1}},{key:"getByteAt",value:function(d){for(var b,c=0;c<this._fileData.length;c++){var a=this._fileData[c].offset,e=a+this._fileData[c].data.length-1;if(d>=a&&d<=e){b=this._fileData[c];break}}if(b)return b.data[d-b.offset];throw Error("Offset "+d+" hasn't been loaded yet.");
}}]);return f}();m.exports=f},{"./FlowTypes":5}],5:[function(f,m,k){f("./MediaFileReader")},{"./MediaFileReader":10}],6:[function(f,m,k){function l(b,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);b.prototype=Object.create(c&&c.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(b,c):b.__proto__=c)}var h=function(){function b(b,a){for(var e=0;e<a.length;e++){var g=
a[e];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(b,g.key,g)}}return function(c,a,e){a&&b(c.prototype,a);e&&b(c,e);return c}}();f("./FlowTypes");k=f("./MediaTagReader");f("./MediaFileReader");f=function(b){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(c).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}l(c,b);h(c,[{key:"_loadData",value:function(a,b){var g=a.getSize();a.loadRange([g-128,g-1],b)}},{key:"_parseData",value:function(a,b){var g=a.getSize()-128,c=a.getStringWithCharsetAt(g+3,30).toString(),q=a.getStringWithCharsetAt(g+33,30).toString(),f=a.getStringWithCharsetAt(g+63,30).toString(),u=a.getStringWithCharsetAt(g+93,4).toString(),r=a.getByteAt(g+97+28),t=a.getByteAt(g+97+29);if(0==r&&0!=t)var r="1.1",n=a.getStringWithCharsetAt(g+
97,28).toString();else r="1.0",n=a.getStringWithCharsetAt(g+97,30).toString(),t=0;g=a.getByteAt(g+97+30);c={type:"ID3",version:r,tags:{title:c,artist:q,album:f,year:u,comment:n,genre:255>g?d[g]:""}};t&&(c.tags.track=t);return c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(a){return"TAG"===String.fromCharCode.apply(String,a.slice(0,3))}}]);return c}(k);var d="Blues;Classic Rock;Country;Dance;Disco;Funk;Grunge;Hip-Hop;Jazz;Metal;New Age;Oldies;Other;Pop;R&B;Rap;Reggae;Rock;Techno;Industrial;Alternative;Ska;Death Metal;Pranks;Soundtrack;Euro-Techno;Ambient;Trip-Hop;Vocal;Jazz+Funk;Fusion;Trance;Classical;Instrumental;Acid;House;Game;Sound Clip;Gospel;Noise;AlternRock;Bass;Soul;Punk;Space;Meditative;Instrumental Pop;Instrumental Rock;Ethnic;Gothic;Darkwave;Techno-Industrial;Electronic;Pop-Folk;Eurodance;Dream;Southern Rock;Comedy;Cult;Gangsta;Top 40;Christian Rap;Pop/Funk;Jungle;Native American;Cabaret;New Wave;Psychadelic;Rave;Showtunes;Trailer;Lo-Fi;Tribal;Acid Punk;Acid Jazz;Polka;Retro;Musical;Rock & Roll;Hard Rock;Folk;Folk-Rock;National Folk;Swing;Fast Fusion;Bebob;Latin;Revival;Celtic;Bluegrass;Avantgarde;Gothic Rock;Progressive Rock;Psychedelic Rock;Symphonic Rock;Slow Rock;Big Band;Chorus;Easy Listening;Acoustic;Humour;Speech;Chanson;Opera;Chamber Music;Sonata;Symphony;Booty Bass;Primus;Porn Groove;Satire;Slow Jam;Club;Tango;Samba;Folklore;Ballad;Power Ballad;Rhythmic Soul;Freestyle;Duet;Punk Rock;Drum Solo;Acapella;Euro-House;Dance Hall".split(";");
m.exports=f},{"./FlowTypes":5,"./MediaFileReader":10,"./MediaTagReader":11}],7:[function(f,m,k){function l(b){var c;switch(b){case 0:c="iso-8859-1";break;case 1:c="utf-16";break;case 2:c="utf-16be";break;case 3:c="utf-8"}return c}f("./FlowTypes");f("./MediaFileReader");var h={APIC:function(b,c,a,e,g){g=g||"3";e=b;var p=l(a.getByteAt(b));switch(g){case "2":var q=a.getStringAt(b+1,3);b+=4;break;case "3":case "4":q=a.getStringWithCharsetAt(b+1,c-(b-e)),b+=1+q.bytesReadCount}g=a.getByteAt(b,1);g=d[g];
p=a.getStringWithCharsetAt(b+1,c-(b-e),p);b+=1+p.bytesReadCount;return{format:q.toString(),type:g,description:p.toString(),data:a.getBytesAt(b,e+c-b)}},COMM:function(b,c,a,e,g){var p=b,d=l(a.getByteAt(b));e=a.getStringAt(b+1,3);g=a.getStringWithCharsetAt(b+4,c-4,d);b+=4+g.bytesReadCount;b=a.getStringWithCharsetAt(b,p+c-b,d);return{language:e,short_description:g.toString(),text:b.toString()}}};h.COM=h.COMM;h.PIC=function(b,c,a,e,g){return h.APIC(b,c,a,e,"2")};h.PCNT=function(b,c,a,e,g){return a.getLongAt(b,
!1)};h.CNT=h.PCNT;h["T*"]=function(b,c,a,e,g){e=l(a.getByteAt(b));return a.getStringWithCharsetAt(b+1,c-1,e).toString()};h.TCON=function(b,c,a,e){return h["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")};h.TCO=h.TCON;h.USLT=function(b,c,a,e,g){var p=b,d=l(a.getByteAt(b));e=a.getStringAt(b+1,3);g=a.getStringWithCharsetAt(b+4,c-4,d);b+=4+g.bytesReadCount;b=a.getStringWithCharsetAt(b,p+c-b,d);return{language:e,descriptor:g.toString(),lyrics:b.toString()}};h.ULT=h.USLT;var d="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");
m.exports={getFrameReaderFunction:function(b){return b in h?h[b]:"T"===b[0]?h["T*"]:null}}},{"./FlowTypes":5,"./MediaFileReader":10}],8:[function(f,m,k){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=
0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,g,c){g&&a(b.prototype,g);c&&a(b,c);return b}}();f("./FlowTypes");k=f("./MediaTagReader");f("./MediaFileReader");var d=f("./ID3v2FrameReader");f=function(a){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(e).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}l(e,a);h(e,[{key:"_loadData",value:function(a,b){a.loadRange([6,9],{onSuccess:function(){a.loadRange([0,10+a.getSynchsafeInteger32At(6)-1],b)},onError:b.onError})}},{key:"_parseData",value:function(a,b){var e=0,d=a.getByteAt(e+3);if(4<d)return{type:"ID3",version:">2.4",tags:{}};var u=a.getByteAt(e+4),f=a.isBitSetAt(e+5,7),t=a.isBitSetAt(e+5,6),n=a.isBitSetAt(e+5,5),h=a.getSynchsafeInteger32At(e+6),e=e+10;if(t)var m=a.getLongAt(e,!0),e=e+
(m+4);var d={type:"ID3",version:"2."+d+"."+u,major:d,revision:u,flags:{unsynchronisation:f,extended_header:t,experimental_indicator:n,footer_present:!1},size:h,tags:{}},e=f?{}:this._readFrames(e,h-10,a,d,b),l;for(l in c)c.hasOwnProperty(l)&&(f=this._getFrameData(e,c[l]))&&(d.tags[l]=f);for(var k in e)e.hasOwnProperty(k)&&(d.tags[k]=e[k]);return d}},{key:"_readFrames",value:function(a,b,e,c,f){var r={};for(f&&(f=this._expandShortcutTags(f));a<b;){var h=this._readFrameHeader(e,a,c),n=h.id;if(0===h.size)break;
if(!n)break;var l=h.flags,k=h.size,m=a+h.headerSize;a+=h.headerSize+h.size;f&&-1===f.indexOf(n)||l&&l.format.unsynchronisation||(l&&l.format.data_length_indicator&&(m+=4,k-=4),l=(h=d.getFrameReaderFunction(n))?h(m,k,e,l):null,m=this._getFrameDescription(n),k={id:n,size:k,description:m,data:l},n in r?(r[n].id&&(r[n]=[r[n]]),r[n].push(k)):r[n]=k)}return r}},{key:"_readFrameHeader",value:function(a,b,e){e=e.major;var c=null;switch(e){case 2:var d=a.getStringAt(b,3),f=a.getInteger24At(b+3,!0),h=6;break;
case 3:d=a.getStringAt(b,4);f=a.getLongAt(b+4,!0);h=10;break;case 4:d=a.getStringAt(b,4),f=a.getSynchsafeInteger32At(b+4),h=10}d&&2<e&&(c=this._readFrameFlags(a,b+8));return{id:d,size:f,headerSize:h,flags:c}}},{key:"_readFrameFlags",value:function(a,b){return{message:{tag_alter_preservation:a.isBitSetAt(b,6),file_alter_preservation:a.isBitSetAt(b,5),read_only:a.isBitSetAt(b,4)},format:{grouping_identity:a.isBitSetAt(b+1,7),compression:a.isBitSetAt(b+1,3),encryption:a.isBitSetAt(b+1,2),unsynchronisation:a.isBitSetAt(b+
1,1),data_length_indicator:a.isBitSetAt(b+1,0)}}}},{key:"_getFrameData",value:function(a,b){for(var e=0,c;c=b[e];e++)if(c in a)return a[c].data}},{key:"_getFrameDescription",value:function(a){return a in b?b[a]:"Unknown"}},{key:"getShortcuts",value:function(){return c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(a){return"ID3"===String.fromCharCode.apply(String,a.slice(0,3))}}]);return e}(k);var b={BUF:"Recommended buffer size",
CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",
TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",
TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",
WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",
IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",
TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",
TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",
TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",
WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},c={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};m.exports=f},{"./FlowTypes":5,"./ID3v2FrameReader":7,"./MediaFileReader":10,"./MediaTagReader":11}],9:[function(f,m,k){function l(a,
b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();f("./FlowTypes");k=f("./MediaTagReader");f("./MediaFileReader");f=function(a){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(e).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}l(e,a);h(e,[{key:"_loadData",value:function(a,b){var e=this;a.loadRange([0,
16],{onSuccess:function(){e._loadAtom(a,0,"",b)},onError:b.onError})}},{key:"_loadAtom",value:function(a,b,e,c){if(b>=a.getSize())c.onSuccess();else{var d=this,f=a.getLongAt(b,!0);if(0==f||isNaN(f))c.onSuccess();else{var h=a.getStringAt(b+4,4);if(this._isContainerAtom(h)){"meta"==h&&(b+=4);var n=(e?e+".":"")+h;"moov.udta.meta.ilst"===n?a.loadRange([b,b+f],c):a.loadRange([b+8,b+8+8],{onSuccess:function(){d._loadAtom(a,b+8,n,c)},onError:c.onError})}else a.loadRange([b+f,b+f+8],{onSuccess:function(){d._loadAtom(a,
b+f,e,c)},onError:c.onError})}}}},{key:"_isContainerAtom",value:function(a){return 0<=["moov","udta","meta","ilst"].indexOf(a)}},{key:"_canReadAtom",value:function(a){return"----"!==a}},{key:"_parseData",value:function(a,b){var e={};b=this._expandShortcutTags(b);this._readAtom(e,a,0,a.getSize(),b);for(var d in c)if(c.hasOwnProperty(d)){var f=e[c[d]];f&&(e[d]="track"===d?f.data.track:f.data)}return{type:"MP4",ftyp:a.getStringAt(8,4),version:a.getLongAt(12,!0),tags:e}}},{key:"_readAtom",value:function(a,
b,e,c,d,f,h){h=void 0===h?"":h+"  ";for(var n=e;n<e+c;){var l=b.getLongAt(n,!0);if(0==l)break;var k=b.getStringAt(n+4,4);if(this._isContainerAtom(k)){"meta"==k&&(n+=4);this._readAtom(a,b,n+8,l-8,d,(f?f+".":"")+k,h);break}(!d||0<=d.indexOf(k))&&"moov.udta.meta.ilst"===f&&this._canReadAtom(k)&&(a[k]=this._readMetadataAtom(b,n));n+=l}}},{key:"_readMetadataAtom",value:function(a,e){var c=a.getLongAt(e,!0),f=a.getStringAt(e+4,4),h=a.getInteger24At(e+16+1,!0),h=d[h],k;if("trkn"==f)k={track:a.getByteAt(e+
16+11),total:a.getByteAt(e+16+13)};else{var l=e+24,n=c-24;switch(h){case "text":k=a.getStringWithCharsetAt(l,n,"utf-8").toString();break;case "uint8":k=a.getShortAt(l,!1);break;case "jpeg":case "png":k={format:"image/"+h,data:a.getBytesAt(l,n)}}}return{id:f,size:c,description:b[f]||"Unknown",data:k}}},{key:"getShortcuts",value:function(){return c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(a){return"ftyp"===String.fromCharCode.apply(String,
a.slice(4,8))}}]);return e}(k);var d={0:"uint8",1:"text",13:"jpeg",14:"png",21:"uint8"},b={"\u00a9alb":"Album","\u00a9ART":"Artist",aART:"Album Artist","\u00a9day":"Release Date","\u00a9nam":"Title","\u00a9gen":"Genre",gnre:"Genre",trkn:"Track Number","\u00a9wrt":"Composer","\u00a9too":"Encoding Tool","\u00a9enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","\u00a9grp":"Grouping",keyw:"Keywords","\u00a9lyr":"Lyrics","\u00a9cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",
tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code"},c={title:"\u00a9nam",artist:"\u00a9ART",album:"\u00a9alb",year:"\u00a9day",comment:"\u00a9cmt",track:"trkn",
genre:"\u00a9gen",picture:"covr",lyrics:"\u00a9lyr"};m.exports=f},{"./FlowTypes":5,"./MediaFileReader":10,"./MediaTagReader":11}],10:[function(f,m,k){var l=function(){function d(b,c){for(var a=0;a<c.length;a++){var e=c[a];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,a){c&&d(b.prototype,c);a&&d(b,a);return b}}();f("./StringUtils");f("./FlowTypes");var h=f("./StringUtils");f=function(){function d(){if(!(this instanceof
d))throw new TypeError("Cannot call a class as a function");this._isInitialized=!1;this._size=0}l(d,[{key:"init",value:function(b){var c=this;if(this._isInitialized)setTimeout(b.onSuccess,1);else return this._init({onSuccess:function(){c._isInitialized=!0;b.onSuccess()},onError:b.onError})}},{key:"_init",value:function(b){throw Error("Must implement init function");}},{key:"loadRange",value:function(b,c){throw Error("Must implement loadRange function");}},{key:"getSize",value:function(){if(!this._isInitialized)throw Error("init() must be called first.");
return this._size}},{key:"getByteAt",value:function(b){throw Error("Must implement getByteAt function");}},{key:"getBytesAt",value:function(b,c){for(var a=Array(c),e=0;e<c;e++)a[e]=this.getByteAt(b+e);return a}},{key:"isBitSetAt",value:function(b,c){return 0!=(this.getByteAt(b)&1<<c)}},{key:"getSByteAt",value:function(b){b=this.getByteAt(b);return 127<b?b-256:b}},{key:"getShortAt",value:function(b,c){var a=c?(this.getByteAt(b)<<8)+this.getByteAt(b+1):(this.getByteAt(b+1)<<8)+this.getByteAt(b);0>a&&
(a+=65536);return a}},{key:"getSShortAt",value:function(b,c){var a=this.getShortAt(b,c);return 32767<a?a-65536:a}},{key:"getLongAt",value:function(b,c){var a=this.getByteAt(b),e=this.getByteAt(b+1),d=this.getByteAt(b+2),f=this.getByteAt(b+3),a=c?(((a<<8)+e<<8)+d<<8)+f:(((f<<8)+d<<8)+e<<8)+a;0>a&&(a+=4294967296);return a}},{key:"getSLongAt",value:function(b,c){var a=this.getLongAt(b,c);return 2147483647<a?a-4294967296:a}},{key:"getInteger24At",value:function(b,c){var a=this.getByteAt(b),e=this.getByteAt(b+
1),d=this.getByteAt(b+2),a=c?((a<<8)+e<<8)+d:((d<<8)+e<<8)+a;0>a&&(a+=16777216);return a}},{key:"getStringAt",value:function(b,c){for(var a=[],e=b,d=0;e<b+c;e++,d++)a[d]=String.fromCharCode(this.getByteAt(e));return a.join("")}},{key:"getStringWithCharsetAt",value:function(b,c,a){b=this.getBytesAt(b,c);switch((a||"").toLowerCase()){case "utf-16":case "utf-16le":case "utf-16be":a=h.readUTF16String(b,"utf-16be"===a);break;case "utf-8":a=h.readUTF8String(b);break;default:a=h.readNullTerminatedString(b)}return a}},
{key:"getCharAt",value:function(b){return String.fromCharCode(this.getByteAt(b))}},{key:"getSynchsafeInteger32At",value:function(b){var c=this.getByteAt(b),a=this.getByteAt(b+1),e=this.getByteAt(b+2);return this.getByteAt(b+3)&127|(e&127)<<7|(a&127)<<14|(c&127)<<21}}],[{key:"canReadFile",value:function(b){throw Error("Must implement canReadFile function");}}]);return d}();m.exports=f},{"./FlowTypes":5,"./StringUtils":12}],11:[function(f,m,k){var l=function(){function f(d,b){for(var c=0;c<b.length;c++){var a=
b[c];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(d,a.key,a)}}return function(d,b,c){b&&f(d.prototype,b);c&&f(d,c);return d}}();f("./FlowTypes");f("./MediaFileReader");f=function(){function f(d){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._mediaFileReader=d;this._tags=null}l(f,[{key:"setTagsToRead",value:function(d){this._tags=d;return this}},{key:"read",value:function(d){var b=this;this._mediaFileReader.init({onSuccess:function(){b._loadData(b._mediaFileReader,
{onSuccess:function(){var c=b._parseData(b._mediaFileReader,b._tags);d.onSuccess(c)},onError:d.onError})},onError:d.onError})}},{key:"getShortcuts",value:function(){return{}}},{key:"_loadData",value:function(d,b){throw Error("Must implement _loadData function");}},{key:"_parseData",value:function(d,b){throw Error("Must implement _parseData function");}},{key:"_expandShortcutTags",value:function(d){if(!d)return null;for(var b=[],c=this.getShortcuts(),a=0,e;e=d[a];a++)b=b.concat(c[e]||[e]);return b}}],
[{key:"getTagIdentifierByteRange",value:function(){throw Error("Must implement");}},{key:"canReadTagFormat",value:function(d){throw Error("Must implement");}}]);return f}();m.exports=f},{"./FlowTypes":5,"./MediaFileReader":10}],12:[function(f,m,k){var l=function(){function d(b,c){for(var a=0;a<c.length;a++){var e=c[a];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,a){c&&d(b.prototype,c);a&&d(b,a);return b}}(),h=function(){function d(b,
c){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");this._value=b;this.bytesReadCount=c;this.length=b.length}l(d,[{key:"toString",value:function(){return this._value}}]);return d}();m.exports={readUTF16String:function(d,b,c){var a=0,e=1,g=0;c=Math.min(c||d.length,d.length);254==d[0]&&255==d[1]?(b=!0,a=2):255==d[0]&&254==d[1]&&(b=!1,a=2);b&&(e=0,g=1);b=[];for(var f=0;a<c;f++){var k=d[a+e],l=(k<<8)+d[a+g],a=a+2;if(0==l)break;else 216>k||224<=k?b[f]=String.fromCharCode(l):
(k=(d[a+e]<<8)+d[a+g],a+=2,b[f]=String.fromCharCode(l,k))}return new h(b.join(""),a)},readUTF8String:function(d,b){var c=0;b=Math.min(b||d.length,d.length);239==d[0]&&187==d[1]&&191==d[2]&&(c=3);for(var a=[],e=0;c<b;e++){var g=d[c++];if(0==g)break;else if(128>g)a[e]=String.fromCharCode(g);else if(194<=g&&224>g){var f=d[c++];a[e]=String.fromCharCode(((g&31)<<6)+(f&63))}else if(224<=g&&240>g){var f=d[c++],k=d[c++];a[e]=String.fromCharCode(((g&255)<<12)+((f&63)<<6)+(k&63))}else if(240<=g&&245>g){var f=
d[c++],k=d[c++],l=d[c++],g=((g&7)<<18)+((f&63)<<12)+((k&63)<<6)+(l&63)-65536;a[e]=String.fromCharCode((g>>10)+55296,(g&1023)+56320)}}return new h(a.join(""),c)},readNullTerminatedString:function(d,b){var c=[];b=b||d.length;for(var a=0;a<b;){var e=d[a++];if(0==e)break;c[a-1]=String.fromCharCode(e)}return new h(c.join(""),a)}}},{}],13:[function(f,m,k){function l(b,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);b.prototype=
Object.create(c&&c.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(b,c):b.__proto__=c)}var h=function(){function b(b,a){for(var e=0;e<a.length;e++){var d=a[e];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(c,a,e){a&&b(c.prototype,a);e&&b(c,e);return c}}();f("./FlowTypes");var d=f("./ChunkedFileData");k=function(b){function c(a){if(!(this instanceof
c))throw new TypeError("Cannot call a class as a function");var b;b=Object.getPrototypeOf(c).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b._url=a;b._fileData=new d;return b}l(c,b);h(c,[{key:"_init",value:function(a){c._config.avoidHeadRequests?this._fetchSizeWithGetRequest(a):this._fetchSizeWithHeadRequest(a)}},{key:"_fetchSizeWithHeadRequest",value:function(a){var b=this;this._makeXHRRequest("HEAD",
null,{onSuccess:function(c){(c=b._parseContentLength(c))?(b._size=c,a.onSuccess()):b._fetchSizeWithGetRequest(a)},onError:a.onError})}},{key:"_fetchSizeWithGetRequest",value:function(a){var b=this,c=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",c,{onSuccess:function(c){var d=b._parseContentRange(c);c=b._getXhrResponseContent(c);if(d){if(null==d.instanceLength){b._fetchEntireFile(a);return}b._size=d.instanceLength}else b._size=c.length;b._fileData.addData(0,c);a.onSuccess()},onError:a.onError})}},
{key:"_fetchEntireFile",value:function(a){var b=this;this._makeXHRRequest("GET",null,{onSuccess:function(c){c=b._getXhrResponseContent(c);b._size=c.length;b._fileData.addData(0,c);a.onSuccess()},onError:a.onError})}},{key:"_getXhrResponseContent",value:function(a){return a.responseBody||a.responseText||""}},{key:"_parseContentLength",value:function(a){a=this._getResponseHeader(a,"Content-Length");return null==a?a:parseInt(a,10)}},{key:"_parseContentRange",value:function(a){if(a=this._getResponseHeader(a,
"Content-Range")){var b=a.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!b)throw Error("FIXME: Unknown Content-Range syntax: ",a);return{firstBytePosition:parseInt(b[1],10),lastBytePosition:parseInt(b[2],10),instanceLength:b[3]?parseInt(b[3],10):null}}return null}},{key:"loadRange",value:function(a,b){var c=this;c._fileData.hasDataRange(a[0],a[1])?setTimeout(b.onSuccess,1):(a=this._roundRangeToChunkMultiple(a),this._makeXHRRequest("GET",a,{onSuccess:function(d){d=c._getXhrResponseContent(d);c._fileData.addData(a[0],
d);b.onSuccess()},onError:b.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(a){return[a[0],a[0]+1024*Math.ceil((a[1]-a[0]+1)/1024)-1]}},{key:"_makeXHRRequest",value:function(a,b,c){var d=this._createXHRObject(),f=function(){if(200===d.status||206===d.status)c.onSuccess(d);else if(c.onError)c.onError({type:"xhr",info:"Unexpected HTTP status "+d.status+".",xhr:d});d=null};"undefined"!==typeof d.onload?(d.onload=f,d.onerror=function(){if(c.onError)c.onError({type:"xhr",info:"Generic XHR error, check xhr object.",
xhr:d})}):d.onreadystatechange=function(){4===d.readyState&&f()};d.open(a,this._url);d.overrideMimeType("text/plain; charset=x-user-defined");b&&this._setRequestHeader(d,"Range","bytes="+b[0]+"-"+b[1]);this._setRequestHeader(d,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");d.send(null)}},{key:"_setRequestHeader",value:function(a,b,d){0>c._config.disallowedXhrHeaders.indexOf(b.toLowerCase())&&a.setRequestHeader(b,d)}},{key:"_hasResponseHeader",value:function(a,b){var c=a.getAllResponseHeaders();
if(!c)return!1;for(var c=c.split("\r\n"),d=[],f=0;f<c.length;f++)d[f]=c[f].split(":")[0].toLowerCase();return 0<=d.indexOf(b.toLowerCase())}},{key:"_getResponseHeader",value:function(a,b){return this._hasResponseHeader(a,b)?a.getResponseHeader(b):null}},{key:"getByteAt",value:function(a){return this._fileData.getByteAt(a).charCodeAt(0)&255}},{key:"_createXHRObject",value:function(){if("undefined"===typeof window)return new (f("xhr2").XMLHttpRequest);if(window.XMLHttpRequest)return new window.XMLHttpRequest;
throw Error("XMLHttpRequest is not supported");}}],[{key:"canReadFile",value:function(a){return"string"===typeof a&&/^[a-z]+:\/\//i.test(a)}},{key:"setConfig",value:function(a){for(var b in a)a.hasOwnProperty(b)&&(this._config[b]=a[b]);a=this._config.disallowedXhrHeaders;for(b=0;b<a.length;b++)a[b]=a[b].toLowerCase()}}]);return c}(f("./MediaFileReader"));k._config={avoidHeadRequests:!1,disallowedXhrHeaders:[]};m.exports=k},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":10,xhr2:2}],14:[function(f,
m,k){function l(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");}var h=function(){function b(a,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();f("./FlowTypes");f("./MediaFileReader");k=f("./NodeFileReader");var d=f("./XhrFileReader"),b=f("./BlobFileReader");f("./MediaTagReader");var c=f("./ID3v1TagReader"),
a=f("./ID3v2TagReader");f=f("./MP4TagReader");var e=[],g=[],p=function(){function a(b){l(this,a);this._file=b}h(a,[{key:"setTagsToRead",value:function(a){this._tagsToRead=a;return this}},{key:"setFileReader",value:function(a){this._fileReader=a;return this}},{key:"setTagReader",value:function(a){this._tagReader=a;return this}},{key:"read",value:function(a){var b=new (this._getFileReader())(this._file),c=this;b.init({onSuccess:function(){c._getTagReader(b,{onSuccess:function(d){(new d(b)).setTagsToRead(c._tagsToRead).read(a)},
onError:a.onError})},onError:a.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var a=0;a<e.length;a++)if(e[a].canReadFile(this._file))return e[a];throw Error("No suitable file reader found for ",this._file);}},{key:"_getTagReader",value:function(a,b){if(this._tagReader){var c=this._tagReader;setTimeout(function(){b.onSuccess(c)},1)}else this._findTagReader(a,b)}},{key:"_findTagReader",
value:function(a,b){for(var c=[],d=[],e=a.getSize(),f=0;f<g.length;f++){var h=g[f].getTagIdentifierByteRange();0<=h.offset&&h.offset<e/2||0>h.offset&&h.offset<-e/2?c.push(g[f]):d.push(g[f])}var k=!1,f={onSuccess:function(){if(k){for(var c=0;c<g.length;c++){var d=g[c].getTagIdentifierByteRange(),d=a.getBytesAt(0<=d.offset?d.offset:d.offset+e,d.length);if(g[c].canReadTagFormat(d)){b.onSuccess(g[c]);return}}if(b.onError)b.onError({type:"tagFormat",info:"No suitable tag reader found"})}else k=!0},onError:b.onError};
this._loadTagIdentifierRanges(a,c,f);this._loadTagIdentifierRanges(a,d,f)}},{key:"_loadTagIdentifierRanges",value:function(a,b,c){if(0===b.length)setTimeout(c.onSuccess,1);else{for(var d=[Number.MAX_VALUE,0],e=a.getSize(),f=0;f<b.length;f++){var g=b[f].getTagIdentifierByteRange(),h=0<=g.offset?g.offset:g.offset+e,g=h+g.length-1;d[0]=Math.min(h,d[0]);d[1]=Math.max(g,d[1])}a.loadRange(d,c)}}}]);return a}(),q=function(){function a(){l(this,a)}h(a,null,[{key:"addFileReader",value:function(a){e.push(a);
return this}},{key:"addTagReader",value:function(a){g.push(a);return this}},{key:"removeTagReader",value:function(a){a=g.indexOf(a);0<=a&&g.splice(a,1);return this}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function(){d.setConfig({avoidHeadRequests:!0})}},{key:"setDisallowedXhrHeaders",value:function(a){d.setConfig({disallowedXhrHeaders:a})}}]);return a}();q.addFileReader(d).addFileReader(b).addTagReader(a).addTagReader(c).addTagReader(f);"undefined"!==typeof process&&q.addFileReader(k);m.exports=
{read:function(a,b){(new p(a)).read(b)},Reader:p,Config:q}},{"./BlobFileReader":3,"./FlowTypes":5,"./ID3v1TagReader":6,"./ID3v2TagReader":8,"./MP4TagReader":9,"./MediaFileReader":10,"./MediaTagReader":11,"./NodeFileReader":1,"./XhrFileReader":13}]},{},[14])(14)});
