(function(t){"object"===typeof exports&&"undefined"!==typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).jsmediatags=t()})(function(){return function g(n,p,m){function h(a,c){if(!p[a]){if(!n[a]){var d="function"==typeof require&&require;if(!c&&d)return d(a,!0);if(e)return e(a,!0);d=Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d;}d=p[a]=
{exports:{}};n[a][0].call(d.exports,function(c){var d=n[a][1][c];return h(d?d:c)},d,d.exports,g,n,p,m)}return p[a].exports}for(var e="function"==typeof require&&require,a=0;a<m.length;a++)h(m[a]);return h}({1:[function(g,n,p){},{}],2:[function(g,n,p){n.exports=XMLHttpRequest},{}],3:[function(g,n,p){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,c){for(var d=0;d<c.length;d++){var f=c[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g("./FlowTypes");var e=g("./ChunkedFileData");g=function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
var d;d=Object.getPrototypeOf(b).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!d||"object"!==typeof d&&"function"!==typeof d?this:d;d._blob=a;d._fileData=new e;return d}m(b,a);h(b,[{key:"_init",value:function(a){this._size=this._blob.size;setTimeout(a.onSuccess,1)}},{key:"loadRange",value:function(a,b){var f=this,k=(this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice).call(this._blob,a[0],a[1]+1),l=new FileReader;l.onloadend=
function(k){k=new Uint8Array(l.result);f._fileData.addData(a[0],k);b.onSuccess()};l.onerror=l.onabort=function(a){if(b.onError)b.onError({type:"blob",blob:l.error})};l.readAsArrayBuffer(k)}},{key:"getByteAt",value:function(a){return this._fileData.getByteAt(a)}}],[{key:"canReadFile",value:function(a){return"undefined"!==typeof Blob&&a instanceof Blob}}]);return b}(g("./MediaFileReader"));n.exports=g},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":8}],4:[function(g,n,p){var m=function(){function h(e,
a){for(var b=0;b<a.length;b++){var c=a[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(e,c.key,c)}}return function(e,a,b){a&&h(e.prototype,a);b&&h(e,b);return e}}();g("./FlowTypes");g=function(){function h(){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this._fileData=[]}m(h,null,[{key:"NOT_FOUND",get:function(){return-1}}]);m(h,[{key:"addData",value:function(e,a){var b=e+a.length-1,c=this._getChunkRange(e,b);
if(-1===c.startIx)this._fileData.splice(c.insertIx||0,0,{offset:e,data:a});else{var d=this._fileData[c.startIx],f=this._fileData[c.endIx],b=b<f.offset+f.data.length,k={offset:Math.min(e,d.offset),data:a};e>d.offset&&(d=d.data.slice(0,e-d.offset),k.data=this._concatData(d,a));b&&(d=a.slice(0,f.offset-e),k.data=this._concatData(d,f.data));this._fileData.splice(c.startIx,c.endIx-c.startIx+1,k)}}},{key:"_concatData",value:function(e,a){if("undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView(e)){var b=
new e.constructor(e.length+a.length);b.set(e,0);b.set(a,e.length);return b}return e.concat(a)}},{key:"_getChunkRange",value:function(e,a){for(var b=-1,c=-1,d=0,f=0;f<this._fileData.length;f++,d=f){var k=this._fileData[f].offset,l=k+this._fileData[f].data.length;if(a<k-1)break;if(e<=l+1&&a>=k-1){b=f;break}}if(-1===b)return{startIx:-1,endIx:-1,insertIx:d};for(f=b;f<this._fileData.length&&!(k=this._fileData[f].offset,l=k+this._fileData[f].data.length,a>=k-1&&(c=f),a<=l+1);f++);-1===c&&(c=b);return{startIx:b,
endIx:c}}},{key:"hasDataRange",value:function(e,a){for(var b=0;b<this._fileData.length;b++){var c=this._fileData[b];if(a<c.offset)break;if(e>=c.offset&&a<c.offset+c.data.length)return!0}return!1}},{key:"getByteAt",value:function(e){for(var a,b=0;b<this._fileData.length;b++)if(e>=this._fileData[b].offset){a=this._fileData[b];break}if(a&&(b=e-a.offset,b<a.data.length))return a.data[b];throw Error("Offset "+e+" hasn't been loaded yet.");}}]);return h}();n.exports=g},{"./FlowTypes":5}],5:[function(g,
n,p){g("./MediaFileReader")},{"./MediaFileReader":8}],6:[function(g,n,p){function m(a){var b;switch(a){case 0:b="iso-8859-1";break;case 1:b="utf-16";break;case 2:b="utf-16be";break;case 3:b="utf-8"}return b}g("./FlowTypes");g("./MediaFileReader");var h={APIC:function(a,b,c,d,f){f=f||"3";d=a;var k=m(c.getByteAt(a));switch(f){case "2":var l=c.getStringAt(a+1,3);a+=4;break;case "3":case "4":l=c.getStringWithCharsetAt(a+1,b-(a-d)),a+=1+l.bytesReadCount}f=c.getByteAt(a,1);f=e[f];k=c.getStringWithCharsetAt(a+
1,b-(a-d),k);a+=1+k.bytesReadCount;return{format:l.toString(),type:f,description:k.toString(),data:c.getBytesAt(a,d+b-a)}},COMM:function(a,b,c,d,f){var k=a,l=m(c.getByteAt(a));d=c.getStringAt(a+1,3);f=c.getStringWithCharsetAt(a+4,b-4,l);a+=4+f.bytesReadCount;a=c.getStringWithCharsetAt(a,k+b-a,l);return{language:d,short_description:f.toString(),text:a.toString()}}};h.COM=h.COMM;h.PIC=function(a,b,c,d,f){return h.APIC(a,b,c,d,"2")};h.PCNT=function(a,b,c,d,f){return c.getLongAt(a,!1)};h.CNT=h.PCNT;h["T*"]=
function(a,b,c,d,f){d=m(c.getByteAt(a));return c.getStringWithCharsetAt(a+1,b-1,d).toString()};h.TCON=function(a,b,c,d){return h["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")};h.TCO=h.TCON;h.USLT=function(a,b,c,d,f){var k=a,l=m(c.getByteAt(a));d=c.getStringAt(a+1,3);f=c.getStringWithCharsetAt(a+4,b-4,l);a+=4+f.bytesReadCount;a=c.getStringWithCharsetAt(a,k+b-a,l);return{language:d,descriptor:f.toString(),lyrics:a.toString()}};h.ULT=h.USLT;var e="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");
n.exports={getFrameReaderFunction:function(a){return a in h?h[a]:"T"===a[0]?h["T*"]:null}}},{"./FlowTypes":5,"./MediaFileReader":8}],7:[function(g,n,p){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(c,b){for(var k=
0;k<b.length;k++){var l=b[k];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(c,l.key,l)}}return function(b,f,k){f&&a(b.prototype,f);k&&a(b,k);return b}}();g("./FlowTypes");p=g("./MediaTagReader");g("./MediaFileReader");var e=g("./ID3v2FrameReader");g=function(c){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(d).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}m(d,c);h(d,[{key:"_loadData",value:function(a,b){a.loadRange([6,9],{onSuccess:function(){a.loadRange([0,a.getSynchsafeInteger32At(6)],b)},onError:b.onError})}},{key:"_parseData",value:function(a,c){var d=0,e=a.getByteAt(d+3);if(4<e)return{version:">2.4"};var h=a.getByteAt(d+4),g=a.isBitSetAt(d+5,7),n=a.isBitSetAt(d+5,6),m=a.isBitSetAt(d+5,5),p=a.getSynchsafeInteger32At(d+6),d=d+10;if(n)var r=a.getLongAt(d,!0),d=d+(r+4);var e={version:"2."+
e+"."+h,major:e,revision:h,flags:{unsynchronisation:g,extended_header:n,experimental_indicator:m,footer_present:!1},size:p,tags:{}},d=g?{}:this._readFrames(d,p-10,a,e,c),q;for(q in b)b.hasOwnProperty(q)&&(g=this._getFrameData(d,b[q]))&&(e.tags[q]=g);for(var u in d)d.hasOwnProperty(u)&&(e.tags[u]=d[u]);return e}},{key:"_readFrames",value:function(a,b,c,d,g){var h={};for(g&&(g=this._expandShortcutTags(g));a<b;){var n=this._readFrameHeader(c,a,d),m=n.id;if(0===n.size)break;if(!m)break;var p=n.flags,
r=n.size,q=a+n.headerSize;a+=n.headerSize+n.size;g&&-1===g.indexOf(m)||p&&p.format.unsynchronisation||(p&&p.format.data_length_indicator&&(q+=4,r-=4),p=(n=e.getFrameReaderFunction(m))?n(q,r,c,p):null,q=this._getFrameDescription(m),r={id:m,size:r,description:q,data:p},m in h?(h[m].id&&(h[m]=[h[m]]),h[m].push(r)):h[m]=r)}return h}},{key:"_readFrameHeader",value:function(a,b,c){c=c.major;var d=null;switch(c){case 2:var e=a.getStringAt(b,3),h=a.getInteger24At(b+3,!0),g=6;break;case 3:e=a.getStringAt(b,
4);h=a.getLongAt(b+4,!0);g=10;break;case 4:e=a.getStringAt(b,4),h=a.getSynchsafeInteger32At(b+4),g=10}e&&2<c&&(d=this._readFrameFlags(a,b+8));return{id:e,size:h,headerSize:g,flags:d}}},{key:"_readFrameFlags",value:function(a,b){return{message:{tag_alter_preservation:a.isBitSetAt(b,6),file_alter_preservation:a.isBitSetAt(b,5),read_only:a.isBitSetAt(b,4)},format:{grouping_identity:a.isBitSetAt(b+1,7),compression:a.isBitSetAt(b+1,3),encryption:a.isBitSetAt(b+1,2),unsynchronisation:a.isBitSetAt(b+1,1),
data_length_indicator:a.isBitSetAt(b+1,0)}}}},{key:"_getFrameData",value:function(a,b){for(var c=0,d;d=b[c];c++)if(d in a)return a[d].data}},{key:"_getFrameDescription",value:function(b){return b in a?a[b]:"Unknown"}},{key:"_expandShortcutTags",value:function(a){for(var c=[],d=0,e;e=a[d];d++)c=c.concat(b[e]||[e]);return c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(a){return"ID3"===String.fromCharCode.apply(String,a.slice(0,
3))}}]);return d}(p);var a={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",
TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",
TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",
ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",
GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",
TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",
TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",
TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",
WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},b={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};n.exports=g},{"./FlowTypes":5,"./ID3v2FrameReader":6,"./MediaFileReader":8,
"./MediaTagReader":9}],8:[function(g,n,p){var m=function(){function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,c){b&&e(a.prototype,b);c&&e(a,c);return a}}();g("./StringUtils");g("./FlowTypes");var h=g("./StringUtils");g=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._isInitialized=!1;this._size=0}m(e,[{key:"init",
value:function(a){var b=this;if(this._isInitialized)setTimeout(a.onSuccess,1);else return this._init({onSuccess:function(){b._isInitialized=!0;a.onSuccess()},onError:a.onError})}},{key:"_init",value:function(a){throw Error("Must implement init function");}},{key:"loadRange",value:function(a,b){throw Error("Must implement loadRange function");}},{key:"getSize",value:function(){if(!this._isInitialized)throw Error("init() must be called first.");return this._size}},{key:"getByteAt",value:function(a){throw Error("Must implement getByteAt function");
}},{key:"getBytesAt",value:function(a,b){for(var c=Array(b),d=0;d<b;d++)c[d]=this.getByteAt(a+d);return c}},{key:"isBitSetAt",value:function(a,b){return 0!=(this.getByteAt(a)&1<<b)}},{key:"getSByteAt",value:function(a){a=this.getByteAt(a);return 127<a?a-256:a}},{key:"getShortAt",value:function(a,b){var c=b?(this.getByteAt(a)<<8)+this.getByteAt(a+1):(this.getByteAt(a+1)<<8)+this.getByteAt(a);0>c&&(c+=65536);return c}},{key:"getSShortAt",value:function(a,b){var c=this.getShortAt(a,b);return 32767<c?
c-65536:c}},{key:"getLongAt",value:function(a,b){var c=this.getByteAt(a),d=this.getByteAt(a+1),e=this.getByteAt(a+2),k=this.getByteAt(a+3),c=b?(((c<<8)+d<<8)+e<<8)+k:(((k<<8)+e<<8)+d<<8)+c;0>c&&(c+=4294967296);return c}},{key:"getSLongAt",value:function(a,b){var c=this.getLongAt(a,b);return 2147483647<c?c-4294967296:c}},{key:"getInteger24At",value:function(a,b){var c=this.getByteAt(a),d=this.getByteAt(a+1),e=this.getByteAt(a+2),c=b?((c<<8)+d<<8)+e:((e<<8)+d<<8)+c;0>c&&(c+=16777216);return c}},{key:"getStringAt",
value:function(a,b){for(var c=[],d=a,e=0;d<a+b;d++,e++)c[e]=String.fromCharCode(this.getByteAt(d));return c.join("")}},{key:"getStringWithCharsetAt",value:function(a,b,c){a=this.getBytesAt(a,b);switch((c||"").toLowerCase()){case "utf-16":case "utf-16le":case "utf-16be":c=h.readUTF16String(a,"utf-16be"===c);break;case "utf-8":c=h.readUTF8String(a);break;default:c=h.readNullTerminatedString(a)}return c}},{key:"getCharAt",value:function(a){return String.fromCharCode(this.getByteAt(a))}},{key:"getSynchsafeInteger32At",
value:function(a){var b=this.getByteAt(a),c=this.getByteAt(a+1),d=this.getByteAt(a+2);return this.getByteAt(a+3)&127|(d&127)<<7|(c&127)<<14|(b&127)<<21}}],[{key:"canReadFile",value:function(a){throw Error("Must implement canReadFile function");}}]);return e}();n.exports=g},{"./FlowTypes":5,"./StringUtils":10}],9:[function(g,n,p){var m=function(){function h(e,a){for(var b=0;b<a.length;b++){var c=a[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(e,
c.key,c)}}return function(e,a,b){a&&h(e.prototype,a);b&&h(e,b);return e}}();g("./FlowTypes");g("./MediaFileReader");g=function(){function h(e){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this._mediaFileReader=e;this._tags=null}m(h,[{key:"setTags",value:function(e){this._tags=e;return this}},{key:"read",value:function(e){var a=this;this._mediaFileReader.init({onSuccess:function(){a._loadData(a._mediaFileReader,{onSuccess:function(){var b=a._parseData(a._mediaFileReader,
a._tags);e.onSuccess(b)},onError:e.onError})},onError:e.onError})}},{key:"_loadData",value:function(e,a){throw Error("Must implement _loadData function");}},{key:"_parseData",value:function(e,a){throw Error("Must implement _parseData function");}}],[{key:"getTagIdentifierByteRange",value:function(){throw Error("Must implement");}},{key:"canReadTagFormat",value:function(e){throw Error("Must implement");}}]);return h}();n.exports=g},{"./FlowTypes":5,"./MediaFileReader":8}],10:[function(g,n,p){var m=
function(){function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,b,c){b&&e(a.prototype,b);c&&e(a,c);return a}}(),h=function(){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._value=a;this.bytesReadCount=b;this.length=a.length}m(e,[{key:"toString",value:function(){return this._value}}]);return e}();n.exports={readUTF16String:function(e,
a,b){var c=0,d=1,f=0;b=Math.min(b||e.length,e.length);254==e[0]&&255==e[1]?(a=!0,c=2):255==e[0]&&254==e[1]&&(a=!1,c=2);a&&(d=0,f=1);a=[];for(var k=0;c<b;k++){var l=e[c+d],g=(l<<8)+e[c+f],c=c+2;if(0==g)break;else 216>l||224<=l?a[k]=String.fromCharCode(g):(l=(e[c+d]<<8)+e[c+f],c+=2,a[k]=String.fromCharCode(g,l))}return new h(a.join(""),c)},readUTF8String:function(e,a){var b=0;a=Math.min(a||e.length,e.length);239==e[0]&&187==e[1]&&191==e[2]&&(b=3);for(var c=[],d=0;b<a;d++){var f=e[b++];if(0==f)break;
else if(128>f)c[d]=String.fromCharCode(f);else if(194<=f&&224>f){var k=e[b++];c[d]=String.fromCharCode(((f&31)<<6)+(k&63))}else if(224<=f&&240>f){var k=e[b++],l=e[b++];c[d]=String.fromCharCode(((f&255)<<12)+((k&63)<<6)+(l&63))}else if(240<=f&&245>f){var k=e[b++],l=e[b++],g=e[b++],f=((f&7)<<18)+((k&63)<<12)+((l&63)<<6)+(g&63)-65536;c[d]=String.fromCharCode((f>>10)+55296,(f&1023)+56320)}}return new h(c.join(""),b)},readNullTerminatedString:function(e,a){var b=[];a=a||e.length;for(var c=0;c<a;){var d=
e[c++];if(0==d)break;b[c-1]=String.fromCharCode(d)}return new h(b.join(""),c)}}},{}],11:[function(g,n,p){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g("./FlowTypes");var e=g("./ChunkedFileData");p=function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var d;d=Object.getPrototypeOf(b).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!d||"object"!==typeof d&&"function"!==typeof d?
this:d;d._url=a;d._fileData=new e;return d}m(b,a);h(b,[{key:"_init",value:function(a){var b=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(e){b._size=parseInt(e.getResponseHeader("Content-Length"),10);a.onSuccess()},onError:a.onError})}},{key:"loadRange",value:function(a,b){var e=this;this._makeXHRRequest("GET",a,{onSuccess:function(k){e._fileData.addData(a[0],k.responseBody||k.responseText);b.onSuccess()},onError:b.onError})}},{key:"_makeXHRRequest",value:function(a,b,e){var k=this._createXHRObject(),
l=function(){if(200===k.status||206===k.status)e.onSuccess(k);else if(e.onError)e.onError({type:"xhr",xhr:k});k=null};"undefined"!==typeof k.onload?(k.onload=l,k.onerror=function(){if(e.onError)e.onError({type:"xhr",xhr:k})}):k.onreadystatechange=function(){4===k.readyState&&l()};k.open(a,this._url);k.overrideMimeType("text/plain; charset=x-user-defined");b&&k.setRequestHeader("Range","bytes="+b[0]+"-"+b[1]);k.setRequestHeader("If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");k.send(null)}},{key:"getByteAt",
value:function(a){return this._fileData.getByteAt(a).charCodeAt(0)&255}},{key:"_createXHRObject",value:function(){if("undefined"===typeof window)return new (g("xhr2").XMLHttpRequest);if(window.XMLHttpRequest)return new window.XMLHttpRequest;throw Error("XMLHttpRequest is not supported");}}],[{key:"canReadFile",value:function(a){return"string"===typeof a&&/^[a-z]+:\/\//i.test(a)}}]);return b}(g("./MediaFileReader"));n.exports=p},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":8,xhr2:2}],
12:[function(g,n,p){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var h=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g("./FlowTypes");g("./MediaFileReader");p=g("./NodeFileReader");var e=g("./XhrFileReader"),a=g("./BlobFileReader");g("./MediaTagReader");
g=g("./ID3v2TagReader");var b=[],c=[],d=function(){function a(b){m(this,a);this._file=b}h(a,[{key:"setTags",value:function(a){this._tags=a;return this}},{key:"setFileReader",value:function(a){this._fileReader=a;return this}},{key:"setTagReader",value:function(a){this._tagReader=a;return this}},{key:"read",value:function(a){var b=new (this._getFileReader())(this._file),c=this;b.init({onSuccess:function(){c._getTagReader(b,{onSuccess:function(d){(new d(b)).setTags(c._tags).read(a)},onError:a.onError})},
onError:a.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var a=0;a<b.length;a++)if(b[a].canReadFile(this._file))return b[a];throw Error("No suitable file reader found for ",this._file);}},{key:"_getTagReader",value:function(a,b){if(this._tagReader){var c=this._tagReader;setTimeout(function(){b.onSuccess(c)},1)}else this._findTagReader(a,b)}},{key:"_findTagReader",value:function(a,b){for(var d=
[],e=[],g=a.getSize(),f=0;f<c.length;f++){var k=c[f].getTagIdentifierByteRange();0<=k.offset&&k.offset<g/2||0>k.offset&&k.offset<-g/2?d.push(c[f]):e.push(c[f])}var h=!1,f={onSuccess:function(){if(h)for(var d=0;d<c.length;d++){var e=c[d].getTagIdentifierByteRange(),e=a.getBytesAt(0<=e.offset?e.offset:e.offset+g,e.length);if(c[d].canReadTagFormat(e)){b.onSuccess(c[d]);break}}else h=!0},onError:b.onError};this._loadTagIdentifierRanges(a,d,f);this._loadTagIdentifierRanges(a,e,f)}},{key:"_loadTagIdentifierRanges",
value:function(a,b,c){if(0===b.length)setTimeout(c.onSuccess,1);else{for(var d=[Number.MAX_VALUE,0],e=a.getSize(),f=0;f<b.length;f++){var g=b[f].getTagIdentifierByteRange(),k=0<=g.offset?g.offset:g.offset+e,g=k+g.length-1;d[0]=Math.min(k,d[0]);d[1]=Math.max(g,d[1])}a.loadRange(d,c)}}}]);return a}(),f=function(){function a(){m(this,a)}h(a,null,[{key:"addFileReader",value:function(a){b.push(a);return this}},{key:"addTagReader",value:function(a){c.push(a);return this}},{key:"removeTagReader",value:function(a){a=
c.indexOf(a);0<=a&&c.splice(a,1);return this}}]);return a}();f.addFileReader(e).addFileReader(a).addTagReader(g);"undefined"!==typeof process&&f.addFileReader(p);n.exports={read:function(a,b){(new d(a)).read(b)},Reader:d,Config:f}},{"./BlobFileReader":3,"./FlowTypes":5,"./ID3v2TagReader":7,"./MediaFileReader":8,"./MediaTagReader":9,"./NodeFileReader":1,"./XhrFileReader":11}]},{},[12])(12)});
